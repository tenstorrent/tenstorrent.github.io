<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kernel Debug Print &mdash; TT-Metalium  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/tt_theme.css?v=ea036265" />

  
    <link rel="shortcut icon" href="../_static/cropped-favicon-32x32.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Watcher" href="watcher.html" />
    <link rel="prev" title="Tools" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



<a href="https://tenstorrent.github.io/docs-test/core/latest/">
    <img src="../_static/tt_logo.svg" class="logo" alt="Logo"/>
</a>

<a href="../index.html">
    TT-Metalium
</a>
    <div class="version">
      v0.49.0
    </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/get_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TT-Metalium</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tt_metal/programming_model/index.html">Programming Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tt_metal/apis/index.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tt_metal/examples/index.html">Programming Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tools</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kernel Debug Print</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling">Enabling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="watcher.html">Watcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracy_profiler.html">Tracy Profiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_program_profiler.html">Device Program Profiler</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resources/support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/contributing.html">Contributing as a developer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TT-Metalium</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tools</a></li>
      <li class="breadcrumb-item active">Kernel Debug Print</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tools/kernel_print.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="kernel-debug-print">
<h1>Kernel Debug Print<a class="headerlink" href="#kernel-debug-print" title="Permalink to this heading"></a>
</h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a>
</h2>
<p>The device can optionally print to the host terminal or a log file.  This feature can be useful for printing variables,
addresses, and Circular Buffer data from kernels running on the device. Device-side prints are controlled through API
calls; the host-side is controlled through environment variables.</p>
</section>
<section id="enabling">
<h2>Enabling<a class="headerlink" href="#enabling" title="Permalink to this heading"></a>
</h2>
<p>Kernel debug printing can be enabled and configured using the environment variables shown below.  The first
environment variable, <code class="docutils literal notranslate"><span class="pre">TT_METAL_DPRINT_CORES</span></code> specifies which cores the host-side will read print data from, and
whether this environment variable is defined determines whether printing is enabled during kernel compilation.
Note that the core coordinates are logical coordinates, so worker cores and ethernet cores both start at (0, 0).</p>
<div class="highlight-default notranslate">
<div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">TT_METAL_DPRINT_CORES</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>     <span class="c1"># required, x,y OR (x1,y1),(x2,y2),(x3,y3) OR (x1,y1)-(x2,y2) OR all</span>
<span class="n">export</span> <span class="n">TT_METAL_DPRINT_ETH_CORES</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span> <span class="c1"># optional, x,y OR (x1,y1),(x2,y2),(x3,y3) OR (x1,y1)-(x2,y2) OR all</span>
<span class="n">export</span> <span class="n">TT_METAL_DPRINT_CHIPS</span><span class="o">=</span><span class="mi">0</span>       <span class="c1"># optional, comma separated list of chips</span>
<span class="n">export</span> <span class="n">TT_METAL_DPRINT_RISCVS</span><span class="o">=</span><span class="n">BR</span>     <span class="c1"># optional, default is all RISCs.  Use a subset of BR,NC,TR0,TR1,TR2</span>
<span class="n">export</span> <span class="n">TT_METAL_DPRINT_FILE</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">txt</span>  <span class="c1"># optional, default is to print to the screen</span>
</pre></div>
</div>
<p>To generate kernel debug prints on the device, include the <code class="docutils literal notranslate"><span class="pre">debug/dprint.h</span></code> header and use the APIs defined there.
And example with the different features available is shown below:</p>
<div class="highlight-c++ notranslate">
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"debug/dprint.h"</span><span class="c1">  // required in all kernels using DPRINT</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">kernel_main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Direct printing is supported for const char*/char/uint32_t/float</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Test string"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'a'</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">0.123456f</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// BF16 type printing is supported via a macro</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">my_bf16_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x3dfb</span><span class="p">;</span><span class="w"> </span><span class="c1">// Equivalent to 0.122559</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">BF16</span><span class="p">(</span><span class="n">my_bf16_val</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// dprint.h includes macros for a subset of std::ios and std::iomanip functionality:</span>
<span class="w">    </span><span class="c1">// SETPRECISION macro has the same behaviour as std::setprecision</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">SETPRECISION</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">0.123456f</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// FIXED and DEFAULTFLOAT macros have the same behaviour as std::fixed and std::defaultfloat</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">FIXED</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">0.123456f</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">DEFAULTFLOAT</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mf">0.123456f</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// SETW macro is the same as std::setw, but with an optional sticky flag (default true)</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"SETW (sticky): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">SETW</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"SETW (non-sticky): "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">SETW</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// HEX/DEC/OCT macros corresponding to std::hex/std::dec/std::oct</span>
<span class="w">    </span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">HEX</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">DEC</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">OCT</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// The following prints only occur on a particular RISCV core:</span>
<span class="w">    </span><span class="n">DPRINT_MATH</span><span class="p">(</span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"this is the math kernel"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">());</span>
<span class="w">    </span><span class="n">DPRINT_PACK</span><span class="p">(</span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"this is the pack kernel"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">());</span>
<span class="w">    </span><span class="n">DPRINT_UNPACK</span><span class="p">(</span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"this is the unpack kernel"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">());</span>
<span class="w">    </span><span class="n">DPRINT_DATA0</span><span class="p">(</span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"this is the data movement kernel on noc 0"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">());</span>
<span class="w">    </span><span class="n">DPRINT_DATA1</span><span class="p">(</span><span class="n">DPRINT</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"this is the data movement kernel on noc 1"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ENDL</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The APIs for printing data from Circular Buffers can be found in <code class="docutils literal notranslate"><span class="pre">debug/dprint_tile.h</span></code>.  These APIs use the
<code class="docutils literal notranslate"><span class="pre">SliceRange</span></code> struct to print tile contents with a given sample count, starting index, and stride.  An example of
how to print data from a CB (in this case, <code class="docutils literal notranslate"><span class="pre">CB::c_intermed1</span></code>) is shown below.  Note that sampling happens relative
to the current CB read or write pointer. This means that for printing a tile read from the front of the CB, the
<code class="docutils literal notranslate"><span class="pre">DPRINT</span></code> call has to occur between the <code class="docutils literal notranslate"><span class="pre">cb_wait_front</span></code> and <code class="docutils literal notranslate"><span class="pre">cb_pop_front</span></code> calls. For printing a tile from the
back of the CB, the <code class="docutils literal notranslate"><span class="pre">DPRINT</span></code> call has to occur between the <code class="docutils literal notranslate"><span class="pre">cb_reserve_back</span></code> and <code class="docutils literal notranslate"><span class="pre">cb_push_back</span></code> calls.</p>
<div class="highlight-sh notranslate">
<div class="highlight"><pre><span></span><span class="c1">#include "debug/dprint.h"  // required in all kernels using DPRINT</span>

void<span class="w"> </span>kernel_main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>//<span class="w"> </span>Assuming<span class="w"> </span>the<span class="w"> </span>tile<span class="w"> </span>we<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>print<span class="w"> </span>from<span class="w"> </span>CB::c_intermed1<span class="w"> </span>is<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>front<span class="w"> </span>the<span class="w"> </span>CB,<span class="w"> </span>print<span class="w"> </span>must<span class="w"> </span>happen<span class="w"> </span>after
<span class="w">    </span>//<span class="w"> </span>this<span class="w"> </span>call.<span class="w"> </span>If<span class="w"> </span>the<span class="w"> </span>tile<span class="w"> </span>is<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>back<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>CB,<span class="w"> </span><span class="k">then</span><span class="w"> </span>print<span class="w"> </span>must<span class="w"> </span>happen<span class="w"> </span>after<span class="w"> </span>cb_reserve_back<span class="o">()</span>.
<span class="w">    </span>cb_wait_front<span class="o">(</span>CB::c_intermed1,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>...

<span class="w">    </span>//<span class="w"> </span>Extract<span class="w"> </span>a<span class="w"> </span>numpy<span class="w"> </span>slice<span class="w"> </span><span class="sb">`</span><span class="o">[</span><span class="m">0</span>:32:16,<span class="w"> </span><span class="m">0</span>:32:16<span class="o">]</span><span class="sb">`</span><span class="w"> </span>from<span class="w"> </span>tile<span class="w"> </span><span class="sb">`</span><span class="m">0</span><span class="sb">`</span><span class="w"> </span>from<span class="w"> </span><span class="sb">`</span>CB::c_intermed1<span class="sb">`</span><span class="w"> </span>and<span class="w"> </span>print<span class="w"> </span>it.
<span class="w">    </span>DPRINT<span class="w">  </span><span class="s">&lt;&lt; TSLICE(CB::c_intermed1, 0, SliceRange::hw0_32_16()) &lt;&lt; ENDL();</span>
<span class="s">    // Note that since the MATH core does not have access to CBs, so this is an invalid print:</span>
<span class="s">    DPRINT_MATH({ DPRINT  &lt;&lt; TSLICE</span><span class="o">(</span>CB::c_intermed1,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>SliceRange::hw0_32_16<span class="o">())</span><span class="w"> </span><span class="s">&lt;&lt; ENDL(); }); // Invalid</span>

<span class="s">    // Print a full tile</span>
<span class="s">    for (int32_t r = 0; r &lt; 32; ++r) {</span>
<span class="s">        SliceRange sr = SliceRange{.h0 = r, .h1 = r+1, .hs = 1, .w0 = 0, .w1 = 32, .ws = 1};</span>
<span class="s">        DPRINT &lt;&lt; (uint)r &lt;&lt; " --READ--cin0-- " &lt;&lt; TileSlice(0, 0, sr, true, false) &lt;&lt; ENDL</span><span class="o">()</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>...
<span class="w">    </span>cb_pop_front<span class="o">(</span>CB::c_intermed1,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="watcher.html" class="btn btn-neutral float-right" title="Watcher" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Tenstorrent.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        Version: v0.49.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt>Versions</dt>
            
            <dd><a href="https://tenstorrent.github.io/docs-test/tt-metalium/latest/index.html">latest</a></dd>
            
            <dd><a href="https://tenstorrent.github.io/docs-test/tt-metalium/v0.49.0/index.html">v0.49.0</a></dd>
            
        </dl>
        
        <br>
        </dl>
    </div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>